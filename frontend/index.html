<form id="upload-form">
  <input type="file" id="image-input" name="file" />
  <button type="submit">アップロード</button>
</form>

<progress id="progress-bar" value="0" max="100" style="display:none;"></progress>
<img id="result-image" style="max-width:100%; margin-top:10px;" />

<script>
document.getElementById('upload-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const fileInput = document.getElementById('image-input');
  const file = fileInput.files[0];
  if (!file) return;

  const progress = document.getElementById('progress-bar');
  progress.style.display = "block";
  progress.value = 10;

  const formData = new FormData();
  formData.append("file", file);

  try {
    // frontend/index.html の fetch URL を完全指定にする
const res = await fetch("https://slime-app-template.onrender.com/upload", {
  method: "POST",
  body: formData,
});
    });
    progress.value = 80;
    const blob = await res.blob();
    const imgUrl = URL.createObjectURL(blob);
    document.getElementById('result-image').src = imgUrl;
    progress.value = 100;
  } catch (err) {
    alert("アップロードに失敗しました。");
  }
});
</script>
